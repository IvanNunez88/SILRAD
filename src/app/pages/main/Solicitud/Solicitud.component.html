<p-confirmdialog />
<p-toast />

<div class="card">
    <p-toolbar styleClass="mb-6">
        <ng-template #start>
            <p-button label="Registrar Solicitud" icon="pi pi-plus" (onClick)="registroSolicitud()" class="mr-2" />

            <p-button label="Registrar Solicitud Global" icon="pi pi-plus" (onClick)="registrarSolicitudGlobal()" class="mr-2" />
        </ng-template>

        <ng-template #end>
            <p-button label="Export" icon="pi pi-upload" severity="secondary" />
        </ng-template>
    </p-toolbar>

    <p-table
        #dt
        [value]="listaSolicitud"
        [loading]="mostrarLoading"
        [rows]="10"
        [columns]="columnasTabla"
        [paginator]="true"
        class="table-auto w-full"
        [rowHover]="true"
        dataKey="idSolicitud"
        [rowsPerPageOptions]="[10, 20, 50]"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        [showCurrentPageReport]="true"
    >
        <ng-template #caption>
            <div class="flex items-center justify-between">
                <h5 class="m-0"></h5>
                <p-iconfield>
                    <p-inputicon styleClass="pi pi-search" />
                    <input pInputText type="text" (input)="onGlobalFilter(dt, $event)" [style.width]="'300px'" placeholder="Buscar" />
                </p-iconfield>
            </div>
        </ng-template>

        <ng-template #header>
            <tr>
                <th pSortableColumn="idSolicitud" style="font-weight: bold">
                    <span class="flex items-center gap-2"># Solicitud <p-sortIcon field="idSolicitud" /> </span>
                </th>
                <th pSortableColumn="tipoSolicitud" style="font-weight: bold">
                    <span class="flex items-center gap-2">Tipo Solicitud <p-sortIcon field="tipoSolicitud" /> </span>
                </th>
                <th pSortableColumn="cliente" style="font-weight: bold">
                    <span class="flex items-center gap-2">Cliente <p-sortIcon field="cliente" /> </span>
                </th>
                <th pSortableColumn="tipoServicio" style="font-weight: bold">
                    <span class="flex items-center gap-2">Modalidad<p-sortIcon field="tipoServicio" /> </span>
                </th>
                <th pSortableColumn="origen" style="font-weight: bold">
                    <span class="flex items-center gap-2">Origen <p-sortIcon field="origen" /> </span>
                </th>
                <th pSortableColumn="destino" style="font-weight: bold">
                    <span class="flex items-center gap-2">Destino <p-sortIcon field="destino" /> </span>
                </th>
                <th pSortableColumn="monto" style="font-weight: bold">
                    <span class="flex items-center gap-2">Venta <p-sortIcon field="monto" /> </span>
                </th>
                <th pSortableColumn="isTrasbordo" style="font-weight: bold">
                    <span class="flex items-center gap-2">Trasbordo <p-sortIcon field="isTrasbordo" /> </span>
                </th>
                <th pSortableColumn="isCruce" style="font-weight: bold">
                    <span class="flex items-center gap-2">Cruce <p-sortIcon field="isCruce" /> </span>
                </th>
                <th pSortableColumn="fecEfectivaF" style="font-weight: bold">
                    <span class="flex items-center gap-2">Fec. Efectiva <p-sortIcon field="fecEfectivaF" /> </span>
                </th>
                <th style="min-width: 12rem"></th>
            </tr>
        </ng-template>

        <ng-template #body let-solicitud>
            <tr>
                <td><p-button type="button" label="{{ solicitud.referencia }}" (onClick)="actualizarSolicitud(solicitud)" text /></td>
                <td>{{ solicitud.tipoSolicitud }}</td>
                <td>{{ solicitud.cliente }}</td>
                <td>
                    {{ `${solicitud.tipoServicio} - ${solicitud.tipoUnidad}`}}
                </td>
                <td>{{ solicitud.origen }}</td>
                <td>{{ solicitud.destino }}</td>
                <td>{{ `${solicitud.monto | currency: 'MXN' : 'symbol' : '1.2-2' : 'es-MX'} ${solicitud.codMoneda}` }}</td>
                <td><p-tag [value]="solicitud.isTrasbordo == true ? 'SI' : 'NO'" [severity]="solicitud.isTrasbordo == true ? 'success' : 'danger'"></p-tag></td>
                <td><p-tag [value]="solicitud.isCruce == true ? 'SI' : 'NO'" [severity]="solicitud.isCruce == true ? 'success' : 'danger'"></p-tag></td>
                <td>{{ solicitud.fecEfectivaF }}</td>
                <td>
                    <p-button icon="pi pi-search" severity="help" pTooltip="Registro Proveedor" (onClick)="registroProveedor(solicitud)" [rounded]="true" raised rounded />
                    <p-button icon="pi pi-check" severity="success" pTooltip="Generar RD" [disabled]="solicitud.btnRD" (onClick)="generarRD($event, solicitud)" [rounded]="true" raised rounded />
                    <p-button icon="pi pi-trash" severity="danger" pTooltip="Cancelar Solicitud" (onClick)="cancelarSolicitud($event, solicitud)" [rounded]="true" raised />
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>
